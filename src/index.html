<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Todos</title>
</head>

<body>
    <h1>Todos:</h1>
    <input type="text" id="field-todo" />
    <button type="button" id="btn-add">Add</button>
    <div id="todos"></div>

    <script>
        var input = document.getElementById("field-todo");
        var addlist = document.getElementById("btn-add");
        var container = document.getElementById("todos");

        addlist.addEventListener("click", function() {
            addcontents();
        });
        input.addEventListener("keyup", function(e) {
            if (e.key === "Enter") {
                addcontents();
            }
        });

        function addcontents() {
            var todo = input.value;
            if (!todo) {
                return;
            }
            var span = "<span id = 'delete'>" + "删除" + "</span>";
            var content =
                "<input type='checkbox' id='checkbox'>" +
                "<span id = 'todocontent'>" +
                todo +
                "</span>" +
                " " +
                span;

            container.innerHTML += "<li>" + content + "<br>" + "</li>";
        }
        container.addEventListener('click', function(e) {
            var target = e.target;
            var parent = target.parentNode;

            if (target.id === 'delete') {
                parent.remove();
                return;
            }

            if (target.id === 'checkbox') {
                target.nextElementSibling.style.textDecoration = target.checked ?
                    'line-through' :
                    'none';
            }
        });

        container.addEventListener('dblclick', function(e) {
            if (e.target.id === 'todocontent') {
                // 1. 创建input element
                var input = document.createElement('input');
                // 2. 获取todo当前值
                var current = e.target.innerText;
                // 3. 设置input的默认值
                input.type = 'text';
                input.value = current;
                // 4. 将input插入到todo span元素中
                e.target.innerHTML = "";
                e.target.appendChild(input);
                // 5. 让光标聚焦于句末
                input.focus();
                // 6.光标失焦，将iput的值取出放到todo span中，移除iput
                input.onblur = function() {
                    // var update = input.value;
                    e.target.innerHTML = this.value == current ? current : this.value;
                    //问题1：这里的input失焦后怎么连框也消失了？
                    //因为span的innerHTML被覆盖了

                }

            }
        });
        //
        container.addEventListener('keyup', function(e) {
            if (e.target.tagName === 'INPUT' && e.key === 'Enter') {
                //1、获取input里输入的值
                var current = e.target.value;
                //2、将获取到的值放入 span中
                if (!current) {
                    e.target.parentNode.innerText = current;
                }


            }
        })
    </script>
</body>

</html>